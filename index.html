<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Academic Study Notes</title>
    <style>
        body { margin: 0; background: #f0f0f0; font-family: sans-serif; height: 100vh; display: flex; flex-direction: column; }
        .bar { background: #fff; padding: 10px; display: flex; border-bottom: 1px solid #ccc; }
        input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; }
        button { margin-left: 5px; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; font-weight: bold; }
        #viewer { flex: 1; border: none; background: #fff; }
    </style>
</head>
<body>
    <div class="bar">
        <input type="text" id="u" placeholder="URLをここに（例: youtube.com）" inputmode="url">
        <button id="go">Go</button>
    </div>
    <iframe id="viewer"></iframe>

    <script>
        const go = async () => {
            const u = document.getElementById('u');
            const v = document.getElementById('viewer');
            let target = u.value.trim();
            if (!target) return;
            if (!target.startsWith('http')) target = 'https://' + target;

            // 1. VercelのAPIを呼ぶ（URLを隠すためにBase64で送る）
            const secureUrl = "/proxy/" + btoa(target);
            
            try {
                const res = await fetch(secureUrl);
                const data = await res.json();
                
                // 2. 届いた「無意味なデータ」を、iPadの中でサイトに戻す
                const html = atob(data.content);
                const blob = new Blob([html], { type: 'text/html' });
                v.src = URL.createObjectURL(blob);
            } catch (e) {
                alert("読み込みエラー。別のサイトを試してみて！");
            }
        };

        document.getElementById('go').onclick = go;
        document.getElementById('u').onkeypress = (e) => { if(e.key === 'Enter') go(); };
    </script>
</body>
</html>
