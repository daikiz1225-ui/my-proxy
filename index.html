<script>
    document.getElementById('go').onclick = () => {
        let val = document.getElementById('u').value.trim();
        if (!val) return;
        if (!val.startsWith('http')) val = 'https://' + val;
        const b64 = btoa(unescape(encodeURIComponent(val))).replace(/\//g, '_').replace(/\+/g, '-');
        
        const f = document.getElementById('f');
        f.src = "/proxy/" + b64;

        // ★iframeが読み込まれる瞬間にguard.jsを無理やり流し込む
        f.onload = () => {
            try {
                const script = f.contentWindow.document.createElement('script');
                script.src = "/guard.js";
                f.contentWindow.document.head.appendChild(script);
            } catch(e) {}
        };
    };
</script>
